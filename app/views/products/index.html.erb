<p id="notice"><%= notice %></p>

<h1>Products</h1>

<table>
  <thead>
    <tr>
      <th colspan="3"></th>
    </tr>
  </thead>

  
  <div>
    <% @products.each do |product| %>
        <h1> <%= product.name %> </h2>
        <%= cl_image_tag(product.image.key)%>
        <%= product.description %> 
        <% if product.available == true %>
          Available <%= product.price %>  
        <% end %> 
        <% if product.user_id == current_user.id%>
        <%# Rolify logic for user authorisation can go here %>
          <%= link_to 'Edit', edit_product_path(product) %>
          <%= link_to 'Destroy', product, method: :delete, data: { confirm: 'Are you sure?' } %>
        <%else%>
          <% if current_user_is_following(product.user_id, current_user.id)%>
          <%=link_to 'Following', unfollow_user_path,
                                  class: 'btn unfollow-button',
                                  id: 'unfollow-button',
                                  remote: true,
                                  method: :post%>
          <%else%>
          <%= link_to 'Follow', follow_user_path(:following_id => product.user_id),
                                  remote: true,
                                  class: 'btn follow-button',
                                  id: 'follow-button',
                                  method: :post %>
        <%end%>
      <%end%>
        
    </div>  
<br>

<%= link_to 'New Product', new_product_path %>
<%end%>